%%
%% This is file `onecell.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% onecell.dtx  (with options: `package')
%% ----------------------------------------------------------------
%% onecell -- put everything into a single tabular cell
%% E-mail: jspratte@yahoo.de
%% Released under the LaTeX Project Public License v1.3c or later
%% See http://www.latex-project.org/lppl.txt
%% Or the GPLv3 or later
%% ----------------------------------------------------------------
%% 
\NeedsTeXFormat{LaTeX2e}
\RequirePackage{xparse,array,l3keys2e}

\ProvidesExplPackage
  {onecell} {2017/09/18}
  {v0.1}    {Place contents into a single cell}

%%\StopEventually{^^A
%% \PrintChanges
%% \PrintIndex
%%}
\ExplSyntaxOn

\tl_new:N \l_onecell_align_tl
\tl_new:N \l_onecell_columns_tl
\tl_new:N \l_onecell_use_cols_tl

%% code from https://tex.stackexchange.com/a/358114/117050
\newcolumntype{?}{!{\d@llarend&\span\@gobbletwo}}
\NewDocumentCommand{\onecell}
  {
    s
    >{ \__onecell_excl:n }t!
    >{ \__onecell_processor_Optional_O:Vn \l_onecell_columns_tl }O{}
    O{\l_onecell_align_tl}
    +m
  }{{% leave the double braces, else the command fails
    \__onecell_starred:Nn{#1}{\hspace*{-\tabcolsep}}
    \cs_set_nopar:Nn \__onecell_tabular: { \begin{tabular}[#4] }
    \exp_args:Nx \__onecell_tabular: { #3 \IfBooleanF{ #2 }{ ?#3 } }
      #5%
    \end{tabular}
    \__onecell_starred:Nn{#1}{\hspace*{-\tabcolsep}}
  }}
\NewDocumentCommand{\onecellOptions}{ +m }
  { \keys_set:nn { onecell } { #1 } }
\cs_new:Nn \__onecell_processor_Optional_O:nn
  {
    \tl_if_empty:nTF { #2 }
      { \def\ProcessedArgument{#1} }
      { \def\ProcessedArgument{#2} }
  }
\cs_generate_variant:Nn \__onecell_processor_Optional_O:nn { Vn }

\msg_new:nnn { onecell } { unknown_key }
  { The~key~#1~is~unknown~and~therefore~ignored! }
\keys_define:nn { onecell } {
  ,col     .tl_set_x:N       = \l_onecell_columns_tl
  ,col     .value_required:n = true
  ,columns .meta:n           = { col = #1 }
  ,align   .tl_set_x:N       = \l_onecell_align_tl
  ,pad     .choice:
  ,pad     / remove .code:n  = \cs_set_eq:NN \__onecell_starred:Nn \IfBooleanF
  ,pad     / leave  .code:n  = \cs_set_eq:NN \__onecell_starred:Nn \IfBooleanT
  ,pad     .value_required:n = true
  ,repeat  .choice:
  ,repeat  / true   .code:n  =
    {
      \cs_new_nopar:Npn \__onecell_excl:n ##1 { \def\ProcessedArgument{##1} }
    }
  ,repeat  / false  .code:n  = \cs_set_eq:NN \__onecell_excl:n \ReverseBoolean
  ,repeat  .default:n        = true
  ,default .meta:n           =
    {
      ,col   = c
      ,align = c
      ,pad   = remove
      ,repeat
    }
  ,default .value_forbidden:n = true
  ,unknown .code:n     =
    {
      \msg_error:nnx { onecell } { unknown_key } { \l_keys_key_tl }
    }
}

\keys_set:nn { onecell } { default }

\ProcessKeysOptions { onecell }
\ExplSyntaxOff
%% 
%% Copyright (C) 2017- by Jonathan P. Spratte <jspratte@yahoo.de>
%% 
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License (LPPL), either
%% version 1.3c of this license or (at your option) any later
%% version.  The latest version of this license is in the file:
%% 
%% http://www.latex-project.org/lppl.txt
%% 
%% This work may also be distributed and/or modified under the
%% conditions of the GPLv3 or later.
%% 
%% This work is "maintained" (as per LPPL maintenance status) by
%% Jonathan P. Spratte.
%% 
%% This work consists of the file  onecell.dtx
%% and the derived files           onecell.ins,
%%                                 onecell.pdf and
%%                                 onecell.sty.
%% 
%%
%% End of file `onecell.sty'.
